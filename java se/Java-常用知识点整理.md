#### Java-常用知识点整理

[TOC]

##### 1. B数、B+数和红黑树

 ![img](https://img-blog.csdn.net/20170920132504569?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvemh1YW56aGUxMTc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center) 

 ![img](https://img-blog.csdn.net/20170920132523536?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvemh1YW56aGUxMTc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

 <img src="https://img-blog.csdn.net/20160717102628283" alt="img" style="zoom:80%;" /> 
红黑树：

1. 根节点和叶子节点都是黑色，这里把null指针当成了叶子节点。
2. 红色节点的孩子节点都是黑节点；
3.  **每条路径都包含相同的黑节点.** 



| 红黑树                                                       | B树                                          | B+数                                                        |
| ------------------------------------------------------------ | -------------------------------------------- | ----------------------------------------------------------- |
| B树与红黑树最大的不同在于，B树的结点可以有许多子女，从几个到几千个。 | 除根节点外的每个节点至少有t−1个关键字        | 除根节点外的内部节点，每个节点最多有m个关键字，最少有⌈m/2⌉  |
|                                                              | 每个节点存储data和key                        | 子节点存储索引                                              |
|                                                              | 叶子结点的指针为null                         | 只有叶子节点存储data,而且所有的叶子节点之间增加顺序访问指针 |
|                                                              | 一个节点内如果有x个关键字，则有x+1个孩子指针 | 一个节点内如果有x个关键字，则有x个孩子指针                  |

 ![img](https://img-blog.csdn.net/20170920132729406?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvemh1YW56aGUxMTc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)  

**问1：** **为什么B+树比B树更适合做系统的数据库索引和文件索引** ？

> 一般来说，索引很大，往往以索引文件的形式存储的磁盘上，索引查找时产生磁盘I/O消耗，相对于内存存取，I/O存取的消耗要高几个数量级，所以评价一个数据结构作为索引的优劣最重要的指标就是在查找过程中磁盘I/O操作次数的时间复杂度。树高度越小，I/O次数越少。  

1）**B+树的磁盘读写代价更低**
因为B+树内部结点没有存放数据data,索引比较小，可以存放在一个Block里面，避免树形结构不断的向下查询，减少IO的开销。
2）**B+树的查询更加稳定**
因为非终端结点并不是指向文件内容的结点，仅仅是作为叶子结点的关键字索引，因此所有的关键字查询都会走一条从根节点到叶子结点的路径。即s所有关键字查询的长度是一样的，查询效率稳定。B树的中序遍历过程可能需要跨层，但是B+数不需要。

3） **遍历所有的数据更方便**
B+树只要遍历叶子节点就可以实现整棵树的遍历，而其他的树形结构 要中序遍历才可以访问所有的数据。 

  **B树在提高了磁盘IO性能的同时并没有解决元素遍历的效率低下的问题**， B+树只要遍历叶子节点就可以实现整棵树的遍历。

4) **B+树支持range-query非常方便，而B树不支持** 。



**问2：B树和红黑树的区别**？

 **平衡树（AVL）**更平衡，结构上更加直观，时间效能针对读取而言更高，**但是维护起来比较麻烦！！！** 

 但是，红黑树通过它规则的设定， **每次插入和删除的平均旋转次数应该是远小于平衡树**，确保了插入和删除的最坏的时间复杂度是O(log N) 。 



##### 2. Java—线程安全&&高并发

###### 2.1 解决思路

1. 扩容
2. 缓存
3. 消息队列 AMQ,Kafka,RabitMQ
4. 应用拆分 Dubbo
5. 限流
6. 服务降级或者服务熔断
7. 数据库分库分表
8.  任务调度分布式elastic-job 

###### 2.2 并发的优势与缺点

能够同时处理多个请求；

线程共享数据的时候产生与期望不符合的结果，或者发生活跃性问题，死锁、饥饿等；

###### 2.3 高并发下的数据安全

线程安全： 多个线程同时运行同一段代码，如果每次运行结果和单线程运行的结果是一样的，结果和预期相同，就是线程安全的 。



###### 2.4 案例—秒杀活动

1. 限流 ，验证码
2. 识别黄牛账号【数据挖掘】



##### 3.HashMap/TessMap/ConcurrentSkipList/ConcurrentHashMap

 ![img](https://images0.cnblogs.com/blog/497634/201312/30221944-21a18064c0114e65bffa68c5dadd4f0b.jpg) 







##### 4. Mysql

###### 4.1主从复制、读写分离

主从复制方式： 是使用两个或两个以上相同的数据库，将一个数据库当做**主数据库**，而另一个数据库当做**从数据库。**在**主数据库**中进行相应操作时，**从数据库**记录下所有主数据库的操作，使其二者一模一样。 有**同步复制/异步复制/半同步复制**三种方式。

读写分离： 当**主数据库**进行对数据的增删改也就是写操作时，将查询的任务交给**从数据库** 。

 ###### 4.2 集群

如果说主从复制是各司其职的话，那么集群就是一群同样的个体做着同样的事情。 

###### 4.3 哨兵模式

 里面存储的是自己本身的信息，主服务器的信息，从服务器的信息。 用一个哨兵或者是多个哨兵来监视主服务器是否在正常运行，如果有问题，则找到一个合适的从服务器来代替它。

###### 4.4 非关系型数据库

 所以面对大量的数据读写，非关系型数据库相比较于关系型数据库有着巨大的优势。 key-value存储方式，数据之间没有关联，可扩展性高。

**Redis** 数据存储在内存中，可用来做缓存。需要持久化的数据就将其存入硬盘，不需要持久化的数据，可以进行短暂的存储，提高访问速度。 

###### 4.5 事务

1. ACID特性

>**原子性（Atomicity）**
>原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。
>**一致性（Consistency）**
>事务前后数据的完整性必须保持一致。
>**隔离性（Isolation）**
>事务的隔离性是多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰，多个并发事务之间要相互隔离。
>**持久性（Durability）**
>持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响

2. 事务的隔离级别
   1. 读未提交 read-uncommited （脏读）
   2. 读已提交 read-commited（ **不可重复读侧重于修改，幻读侧重于新增或删除** ）
   3. 可重复读
   4. 串行化

**1、事务隔离级别为读提交时，写数据只会锁住相应的行**

**2、事务隔离级别为可重复读时，如果检索条件有索引（包括主键索引）的时候，默认加锁方式是next-key 锁；如果检索条件没有索引，更新数据时会锁住整张表。一个间隙被事务加了锁，其他事务是不能在这个间隙插入记录的，这样可以防止幻读。**

**3、事务隔离级别为串行化时，读写数据都会锁住整张表**

**4、隔离级别越高，越能保证数据的完整性和一致性，但是对并发性能的影响也越大。**